<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VT Basketball Gameday Input</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, push, onValue, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDnW_VGhEjObMYYRHGsEDo76EH9y3ebJgo",
            authDomain: "vtmbb-gameday.firebaseapp.com",
            databaseURL: "https://vtmbb-gameday-default-rtdb.firebaseio.com",
            projectId: "vtmbb-gameday",
            storageBucket: "vtmbb-gameday.firebasestorage.app",
            messagingSenderId: "1012073356538",
            appId: "1:1012073356538:web:7a41a93d00920d4d00bd43"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        window.firebaseDb = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebasePush = push;
        window.firebaseOnValue = onValue;
        window.firebaseGet = get;
        
        console.log('Firebase initialized successfully');
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const GamedayApp = () => {
            const [gameStarted, setGameStarted] = useState(false);
            const [currentLineup, setCurrentLineup] = useState([3, 2, 17, 1, 13]);
            const [pendingChanges, setPendingChanges] = useState([]);
            const [showConfirmModal, setShowConfirmModal] = useState(false);
            const [gameTime, setGameTime] = useState('');
            const [vtScore, setVtScore] = useState('');
            const [oppScore, setOppScore] = useState('');
            const [lineupChanges, setLineupChanges] = useState([]);
            const [stats, setStats] = useState({
                possessions: 0,
                offensiveRebounds: 0,
                defensiveRebounds: 0,
                turnovers: 0
            });

            const roster = [
                { id: 1, name: "Sean Pedulla", position: "PG" },
                { id: 2, name: "Tyler Nickel", position: "SG" },
                { id: 3, name: "Lynn Kidd", position: "C" },
                { id: 4, name: "Ben Hammond", position: "SG" },
                { id: 5, name: "Mylyjael Poteat", position: "SF" },
                { id: 10, name: "Brandon Rechsteiner", position: "PF" },
                { id: 11, name: "Toibu Lawal", position: "PF" },
                { id: 13, name: "Hysier Miller", position: "PG" },
                { id: 15, name: "Jaden Schutt", position: "SF" },
                { id: 17, name: "Patrick Wessler", position: "PF" },
                { id: 20, name: "Ben Burnham", position: "SG" },
                { id: 23, name: "Con Krzewski", position: "PG" }
            ];

            const startGame = async () => {
                setGameStarted(true);
                
                // Write to Firebase
                if (window.firebaseDb) {
                    try {
                        const gameRef = window.firebaseRef(window.firebaseDb, 'game-info/charleston-southern');
                        await window.firebaseSet(gameRef, {
                            opponent: 'Charleston Southern',
                            started: true,
                            startTime: new Date().toISOString()
                        });
                        
                        const lineupRef = window.firebaseRef(window.firebaseDb, 'current-lineup/charleston-southern');
                        await window.firebaseSet(lineupRef, currentLineup);
                        
                        console.log('Game started successfully');
                    } catch (error) {
                        console.error('Error starting game:', error);
                    }
                }
            };

            const handleLineupChange = (position, playerId) => {
                const newLineup = [...currentLineup];
                const oldPlayer = newLineup[position];
                newLineup[position] = parseInt(playerId);
                
                if (oldPlayer !== parseInt(playerId)) {
                    const change = {
                        position,
                        out: oldPlayer,
                        in: parseInt(playerId),
                        outName: roster.find(p => p.id === oldPlayer)?.name,
                        inName: roster.find(p => p.id === parseInt(playerId))?.name
                    };
                    setPendingChanges([...pendingChanges, change]);
                }
                
                setCurrentLineup(newLineup);
            };

            const confirmChanges = () => {
                if (pendingChanges.length === 0) {
                    alert('No lineup changes to confirm');
                    return;
                }
                setShowConfirmModal(true);
            };

            const saveChanges = async () => {
                if (!gameTime || !vtScore || !oppScore) {
                    alert('Please fill in game time and both scores');
                    return;
                }

                const timestamp = new Date().toISOString();
                const changeRecord = {
                    time: gameTime,
                    vtScore: parseInt(vtScore),
                    oppScore: parseInt(oppScore),
                    changes: pendingChanges,
                    timestamp
                };

                setLineupChanges([...lineupChanges, changeRecord]);
                
                // Save to Firebase
                if (window.firebaseDb) {
                    try {
                        const changesRef = window.firebasePush(window.firebaseRef(window.firebaseDb, 'lineup-changes/charleston-southern'));
                        await window.firebaseSet(changesRef, changeRecord);
                        
                        const lineupRef = window.firebaseRef(window.firebaseDb, 'current-lineup/charleston-southern');
                        await window.firebaseSet(lineupRef, currentLineup);
                        
                        console.log('Changes saved successfully');
                    } catch (error) {
                        console.error('Error saving changes:', error);
                    }
                }

                setPendingChanges([]);
                setShowConfirmModal(false);
                setGameTime('');
                setVtScore('');
                setOppScore('');
            };

            const updateStat = async (statName, change) => {
                const newStats = {
                    ...stats,
                    [statName]: Math.max(0, stats[statName] + change)
                };
                setStats(newStats);
                
                if (window.firebaseDb) {
                    const statsRef = window.firebaseRef(window.firebaseDb, 'current-stats/charleston-southern');
                    await window.firebaseSet(statsRef, newStats);
                }
            };

            return (
                <div className="min-h-screen bg-gray-900 p-4">
                    <div className="max-w-4xl mx-auto">
                        <h1 className="text-3xl font-bold text-white mb-6">VT Basketball Gameday Input</h1>

                        {/* Game Selector */}
                        <div className="bg-gray-800 rounded-lg p-6 mb-6">
                            <select 
                                disabled={gameStarted}
                                className="w-full p-3 bg-gray-700 text-white rounded border border-gray-600"
                            >
                                <option>Charleston Southern</option>
                            </select>
                            
                            {!gameStarted ? (
                                <button
                                    onClick={startGame}
                                    className="mt-4 px-6 py-3 bg-green-600 text-white rounded hover:bg-green-700"
                                >
                                    Start Game
                                </button>
                            ) : (
                                <div className="mt-4 text-green-400 font-semibold">Game Started vs Charleston Southern</div>
                            )}
                        </div>

                        {gameStarted && (
                            <>
                                {/* Current Lineup */}
                                <div className="bg-gray-800 rounded-lg p-6 mb-6">
                                    <h2 className="text-xl font-semibold text-white mb-4">Current Lineup</h2>
                                    
                                    <div className="grid grid-cols-5 gap-4 mb-6">
                                        {currentLineup.map((playerId, index) => (
                                            <div key={index}>
                                                <label className="block text-gray-300 mb-2">Position {index + 1}</label>
                                                <select
                                                    value={playerId}
                                                    onChange={(e) => handleLineupChange(index, e.target.value)}
                                                    className="w-full p-2 bg-gray-700 text-white rounded border border-gray-600"
                                                >
                                                    {roster.filter(player => 
                                                        !currentLineup.includes(player.id) || player.id === playerId
                                                    ).map(player => (
                                                        <option key={player.id} value={player.id}>
                                                            {player.name}
                                                        </option>
                                                    ))}
                                                </select>
                                            </div>
                                        ))}
                                    </div>

                                    {pendingChanges.length > 0 && (
                                        <div className="mb-4">
                                            <h3 className="text-white mb-2">Pending Changes:</h3>
                                            {pendingChanges.map((change, index) => (
                                                <div key={index} className="text-gray-300 bg-gray-700 p-2 rounded mb-2">
                                                    Position {change.position + 1}: {change.outName} → {change.inName}
                                                </div>
                                            ))}
                                            
                                            <button
                                                onClick={confirmChanges}
                                                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                                            >
                                                Confirm Changes
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Stats */}
                                <div className="bg-gray-800 rounded-lg p-6 mb-6">
                                    <h2 className="text-xl font-semibold text-white mb-4">Game Stats</h2>
                                    
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                                        {Object.entries(stats).map(([statName, value]) => (
                                            <div key={statName} className="text-center">
                                                <div className="text-gray-300 mb-2 capitalize">
                                                    {statName.replace(/([A-Z])/g, ' $1').trim()}
                                                </div>
                                                <div className="flex items-center justify-center gap-2">
                                                    <button
                                                        onClick={() => updateStat(statName, -1)}
                                                        className="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700"
                                                    >
                                                        -
                                                    </button>
                                                    <span className="text-white font-bold text-xl min-w-[40px]">
                                                        {value}
                                                    </span>
                                                    <button
                                                        onClick={() => updateStat(statName, 1)}
                                                        className="px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700"
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Lineup Changes History */}
                                <div className="bg-gray-800 rounded-lg p-6">
                                    <h2 className="text-xl font-semibold text-white mb-4">Lineup Changes</h2>
                                    
                                    {lineupChanges.length === 0 ? (
                                        <div className="text-gray-400">No lineup changes yet</div>
                                    ) : (
                                        <div className="space-y-4">
                                            {lineupChanges.map((record, index) => (
                                                <div key={index} className="bg-gray-700 p-4 rounded">
                                                    <div className="text-white font-semibold mb-2">
                                                        {record.time} - VT: {record.vtScore}, CSU: {record.oppScore}
                                                    </div>
                                                    {record.changes.map((change, changeIndex) => (
                                                        <div key={changeIndex} className="text-gray-300">
                                                            Pos {change.position + 1}: {change.outName} → {change.inName}
                                                        </div>
                                                    ))}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </>
                        )}

                        {/* Confirm Changes Modal */}
                        {showConfirmModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
                                <div className="bg-gray-800 rounded-lg p-6 w-full max-w-md">
                                    <h3 className="text-white text-lg font-semibold mb-4">Confirm Changes</h3>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-gray-300 mb-2">Game Time</label>
                                            <input
                                                type="text"
                                                value={gameTime}
                                                onChange={(e) => setGameTime(e.target.value)}
                                                placeholder="e.g., 15:42"
                                                className="w-full p-2 bg-gray-700 text-white rounded border border-gray-600"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-gray-300 mb-2">VT Score</label>
                                            <input
                                                type="number"
                                                value={vtScore}
                                                onChange={(e) => setVtScore(e.target.value)}
                                                className="w-full p-2 bg-gray-700 text-white rounded border border-gray-600"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-gray-300 mb-2">Charleston Southern Score</label>
                                            <input
                                                type="number"
                                                value={oppScore}
                                                onChange={(e) => setOppScore(e.target.value)}
                                                className="w-full p-2 bg-gray-700 text-white rounded border border-gray-600"
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="flex gap-3 mt-6">
                                        <button
                                            onClick={saveChanges}
                                            className="flex-1 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
                                        >
                                            Save
                                        </button>
                                        <button
                                            onClick={() => setShowConfirmModal(false)}
                                            className="flex-1 px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<GamedayApp />, document.getElementById('root'));
    </script>
</body>
</html>
